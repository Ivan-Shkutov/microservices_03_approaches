## Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры. Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

### Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
  
- система контроля версий Git;
  
- репозиторий на каждый сервис;
  
- запуск сборки по событию из системы контроля версий;
  
- запуск сборки по кнопке с указанием параметров;
  
- возможность привязать настройки к каждой сборке;
  
- возможность создания шаблонов для различных конфигураций сборок;
  
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
  
- несколько конфигураций для сборки из одного репозитория;
  
- кастомные шаги при сборке;
  
- собственные докер-образы для сборки проектов;
  
- возможность развернуть агентов сборки на собственных серверах;
  
- возможность параллельного запуска нескольких сборок;
  
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

 - - - - - - - - - - - - - - - - 

### Решение:

Облачная платформа CI/CD с Git-репозиториями и Docker

#### 1. Контроль версий

Инструмент: Git (облачный сервис, например, GitHub, GitLab или Bitbucket).

Организация репозиториев:

Каждый сервис/микросервис хранится в отдельном Git-репозитории.

Для общих библиотек можно использовать отдельный репозиторий или Git Submodule.

Преимущества:

1. Четкая изоляция сервисов.

2. Возможность независимого управления версиями и разрешений.


#### 2. Непрерывная интеграция и поставка (CI/CD)

Инструмент: GitLab CI/CD (облачная версия) или Jenkins X (облачный Jenkins с Kubernetes).

Причины выбора GitLab CI/CD:

Полностью облачное решение.

Глубокая интеграция с Git-репозиториями.

Поддержка запусков сборки по вебхукам и вручную с параметрами.

Возможность создания шаблонов пайплайнов.

Поддержка безопасного хранения секретов.

Настраиваемые шаги сборки.

Поддержка Docker-образов для сборки.

Возможность запуска собственных агентов (runners) на своих серверах.

Параллельное выполнение сборок и тестов.

3. Основные компоненты решения
Компонент	Назначение	Примечания
Git-репозиторий	Хранение исходного кода	Один репозиторий на сервис, ветки для feature, develop, main
CI/CD пайплайн	Автоматизация сборки, тестирования и деплоя	Настраивается через .gitlab-ci.yml или Jenkinsfile
Docker Registry	Хранение кастомных образов для сборки	Можно использовать GitLab Container Registry или Docker Hub
Secret Store	Безопасное хранение ключей и паролей	GitLab Secrets, HashiCorp Vault или AWS Secrets Manager
Build Runner/Agent	Исполнение сборок на облачных или локальных серверах	Можно запускать несколько параллельных агентов
4. Процесс взаимодействия

Разработка:

Разработчик делает коммит в Git-репозиторий.

Git-репозиторий отправляет вебхук в CI/CD платформу.

Сборка по событию:

CI/CD получает сигнал и запускает пайплайн.

Пайплайн использует Docker-образ, указанный в конфигурации, для изоляции сборки.

Секреты подставляются из хранилища безопасно.

Параллельно запускаются тесты.

Сборка по кнопке (manual trigger):

В веб-интерфейсе можно указать параметры сборки (ветка, версия, окружение).

Можно выбрать один из шаблонов пайплайнов с кастомными шагами.

Настройка сборки:

Для одного репозитория можно создавать несколько конфигураций сборки (например, для dev, staging, prod).

Пайплайны могут содержать кастомные шаги: сборка, статический анализ кода, тесты, деплой.

Используются шаблоны пайплайнов, чтобы переиспользовать стандартные шаги.

Параллельное выполнение:

Несколько сборок одного и разных репозиториев могут запускаться параллельно.

Тесты внутри одной сборки могут быть распределены по агентам для ускорения.

Деплой:

После успешной сборки образ может быть отправлен в Docker Registry.

Далее можно выполнять автоматический деплой на облако или on-prem серверы через Helm/Kubernetes, Ansible или Terraform.

5. Соответствие требованиям
Требование	Реализация
Облачная система	GitLab.com / GitHub Actions / Jenkins X в облаке
Система контроля версий Git	Используется GitLab/GitHub
Репозиторий на каждый сервис	Каждый сервис — отдельный репозиторий
Запуск сборки по событию	Webhook из Git
Запуск сборки по кнопке с параметрами	Manual Trigger в GitLab/Jenkins
Привязка настроек к сборке	Переменные и конфигурации пайплайнов
Шаблоны для конфигураций	GitLab CI/CD templates, Jenkins Shared Libraries
Безопасное хранение секретов	GitLab Secrets, Vault, AWS Secrets Manager
Несколько конфигураций сборки	Множественные пайплайны в одном репозитории
Кастомные шаги сборки	Пайплайн шаги через YAML/Jenkinsfile
Собственные Docker-образы	Использование кастомных Dockerfile
Агенты на своих серверах	GitLab Runner / Jenkins Agent
Параллельный запуск сборок	Настройки Runner для параллелизма
Параллельный запуск тестов	Stage/Job параллельность, Matrix Build
6. Дополнительно

Для мониторинга сборок можно использовать встроенный интерфейс CI/CD или внешние инструменты вроде Grafana/Prometheus.

Для масштабируемости и распределения нагрузок можно использовать Kubernetes для запуска агентов сборки.


 - - - - - - - - - - - - - - - - 



### Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;

- минимальные требования к приложениям, сбор логов из stdout;

- гарантированная доставка логов до центрального хранилища;
  
- беспечение поиска и фильтрации по записям логов;
  
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
  
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

 - - - - - - - - - - - - - - - - 

### Решение:




 - - - - - - - - - - - - - - - - 






### Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
  
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
  
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
  
- сбор метрик, специфичных для каждого сервиса;
  
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
  
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

 - - - - - - - - - - - - - - - - 

### Решение:




 - - - - - - - - - - - - - - - - 








Обоснуйте свой выбор.
