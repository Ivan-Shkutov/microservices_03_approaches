## Домашнее задание к занятию «Микросервисы: подходы»

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры. Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

### Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- облачная система;
  
- система контроля версий Git;
  
- репозиторий на каждый сервис;
  
- запуск сборки по событию из системы контроля версий;
  
- запуск сборки по кнопке с указанием параметров;
  
- возможность привязать настройки к каждой сборке;
  
- возможность создания шаблонов для различных конфигураций сборок;
  
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
  
- несколько конфигураций для сборки из одного репозитория;
  
- кастомные шаги при сборке;
  
- собственные докер-образы для сборки проектов;
  
- возможность развернуть агентов сборки на собственных серверах;
  
- возможность параллельного запуска нескольких сборок;
  
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

 - - - - - - - - - - - - - - - - 

### Решение:

Облачная платформа CI/CD с Git-репозиториями и Docker

#### 1. Контроль версий

Инструмент: Git (облачный сервис, например, GitHub, GitLab или Bitbucket).

Преимущества:

1. Четкая изоляция сервисов.

2. Возможность независимого управления версиями и разрешений.


#### 2. Непрерывная интеграция и поставка (CI/CD)

Инструмент: GitLab CI/CD (облачная версия) или Jenkins X (облачный Jenkins с Kubernetes).

Преимущества:

1. Полностью облачное решение.

2. Глубокая интеграция с Git-репозиториями.

3. Поддержка запусков сборки по вебхукам и вручную с параметрами.

4. Возможность создания шаблонов пайплайнов.

5. Поддержка безопасного хранения секретов.

6. Настраиваемые шаги сборки.

7. Поддержка Docker-образов для сборки.

8. Возможность запуска собственных агентов (runners) на своих серверах.

9. Параллельное выполнение сборок и тестов.

![1](https://github.com/Ivan-Shkutov/microservices_03_approaches/blob/main/1.png)


 - - - - - - - - - - - - - - - - 



### Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;

- минимальные требования к приложениям, сбор логов из stdout;

- гарантированная доставка логов до центрального хранилища;
  
- беспечение поиска и фильтрации по записям логов;
  
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
  
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

 - - - - - - - - - - - - - - - - 

### Решение:

#### ELK-стек (Elasticsearch, Logstash, Kibana) + Filebeat/Fluent Bit

#### Принципы работы:

- Сбор логов:

    1. Все микросервисы пишут логи в stdout.

    2. На каждом хосте установлен Filebeat или Fluent Bit, который считывает stdout контейнеров (например, из Docker или Kubernetes) и пересылает в центральное хранилище.

- Доставка и обработка:

    1. Логи направляются в Logstash/Fluentd для:

        - Структурирования данных (JSON, метки сервиса, уровни логов).

        - Фильтрации и нормализации.

        - Надежной доставки в Elasticsearch.

  2. Используются механизмы гарантированной доставки: очередь сообщений (Kafka, Redis, или встроенные буферы Logstash/Fluent Bit).

- Хранение и поиск:

    1. Elasticsearch индексирует логи для быстрого поиска по:

        - Меткам сервисов.

        - Уровню логов (INFO, ERROR, WARN).

        - Времени события.

    2. Поддержка полнотекстового поиска и фильтров.

- Пользовательский интерфейс:

    1. Kibana предоставляет веб-интерфейс для разработчиков:

        - Поиск по записям логов.

        - Создание фильтров и дашбордов.

        - Сохранение поисковых запросов и предоставление ссылок на них.

        - Управление доступом через роли и права (RBAC).


 - - - - - - - - - - - - - - - - 






### Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре. Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:

- сбор метрик со всех хостов, обслуживающих систему;
  
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
  
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
  
- сбор метрик, специфичных для каждого сервиса;
  
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
  
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

 - - - - - - - - - - - - - - - - 

### Решение:




 - - - - - - - - - - - - - - - - 








Обоснуйте свой выбор.
